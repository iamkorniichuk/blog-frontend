<ng-template #cover>
  <div class="cover">
    <img [src]="tutorial().cover" [alt]="tutorial().title" />
    <app-gradient-overlay [sizePercentage]="10" color="surface" side="b" />
  </div>
</ng-template>

<ng-template #heading>
  <h1>{{ tutorial().title }}</h1>
</ng-template>

<ng-template #meta>
  <div class="flex flex-row items-center justify-between mb-2">
    <app-arrow-scroll class="min-w-0 flex-1 overflow-hidden" color="surface">
      <div class="inline-flex gap-1 pr-4">
        @for (tag of tutorial().tags; track $index) {
          <span class="meta-tag">{{ tag }}</span>
        }
      </div>
    </app-arrow-scroll>

    <span class="meta flex-shrink-0 ml-2">
      {{ tutorial().createdAt | date: 'dd/MM/yy HH:MM' }}
    </span>
  </div>
</ng-template>

@let contentAst = tutorial().content | markdownAst;
<ng-template #content>
  @if (contentAst) {
    <app-markdown [ast]="contentAst" />
  }
</ng-template>

<ng-template #contentTable>
  @if (contentAst) {
    <app-toc-markdown [ast]="contentAst" />
  }
</ng-template>

<ng-template #solution>
  @let solutionAst = tutorial().solution | markdownAst;
  @if (solutionAst) {
    <h3>Solution:</h3>
    <app-markdown [ast]="solutionAst"></app-markdown>
  }
</ng-template>

<ng-template #phonePageTemplate>
  <ng-container *ngTemplateOutlet="cover" />
  <ng-container *ngTemplateOutlet="heading" />
  <ng-container *ngTemplateOutlet="meta" />
  <div class="card">
    <ng-container *ngTemplateOutlet="solution" />
  </div>
  <ng-container *ngTemplateOutlet="content" />
  <button
    (click)="isPopupVisible.set(true)"
    class="btn btn-icon btn-primary fixed right-0 bottom-8 text-4xl rounded-tr-none rounded-br-none"
  >
    <app-list-icon title="Open Table of Contents" />
  </button>
  @if (isPopupVisible()) {
    <div class="popup-overlay"></div>
    <button (click)="isPopupVisible.set(false)" class="popup text-left">
      <button (click)="isPopupVisible.set(false)" class="btn btn-icon absolute top-2 right-2">
        <app-close-icon title="Close Table of Contents" />
      </button>
      <ng-container *ngTemplateOutlet="contentTable" />
    </button>
  }
</ng-template>

<ng-template #desktopContentTemplate>
  <ng-container *ngTemplateOutlet="cover" />
  <ng-container *ngTemplateOutlet="heading" />
  <ng-container *ngTemplateOutlet="meta" />
  <ng-container *ngTemplateOutlet="content" />
</ng-template>

<ng-template #desktopContentTableTemplate>
  <div
    class="content-card sticky left-0"
    style="top: calc(var(--navbar-height) + calc(var(--spacing) * 4))"
  >
    <ng-container *ngTemplateOutlet="contentTable" />
  </div>
</ng-template>

<ng-template #desktopSolutionTemplate>
  <div class="content-card">
    <ng-container *ngTemplateOutlet="solution" />
  </div>
</ng-template>

<app-content-page
  [phonePageTemplate]="phonePageTemplate"
  [desktopContentTemplate]="desktopContentTemplate"
  [desktopCardTemplates]="[desktopSolutionTemplate, desktopContentTableTemplate]"
/>
